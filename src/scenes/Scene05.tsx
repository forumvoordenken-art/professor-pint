import React, { useMemo } from 'react';
import { AbsoluteFill, interpolate, spring, useCurrentFrame, useVideoConfig } from 'remotion';
import { ProfessorPint } from '../components/ProfessorPint';
import { SceneShell } from '../components/SceneShell';
import { Palette } from '../design-system/Palette';

type GrassData = { id: number; x: number; y: number; h: number; width: number; hue: string; delay: number; offset: number; layer: number };
type OakSeed = { id: number; x: number; y: number; scale: number; jitter: number; tone: string };
type Villager = { id: number; x: number; y: number; scale: number; action: number };

const clamp = (v: number, min: number, max: number): number => Math.min(max, Math.max(min, v));
const seededRandom = (seed: number): (() => number) => { let s = seed; return () => { s = (1664525 * s + 1013904223) % 4294967296; return s / 4294967296; }; };

const WIND_MARKERS = [
  { x: 20, y: 450, o: 0.03 },
  { x: 33, y: 467, o: 0.05 },
  { x: 46, y: 484, o: 0.07 },
  { x: 59, y: 501, o: 0.09 },
  { x: 72, y: 518, o: 0.11 },
  { x: 85, y: 535, o: 0.13 },
  { x: 98, y: 552, o: 0.15 },
  { x: 111, y: 569, o: 0.17 },
  { x: 124, y: 586, o: 0.19 },
  { x: 137, y: 603, o: 0.03 },
  { x: 150, y: 620, o: 0.05 },
  { x: 163, y: 637, o: 0.07 },
  { x: 176, y: 654, o: 0.09 },
  { x: 189, y: 671, o: 0.11 },
  { x: 202, y: 688, o: 0.13 },
  { x: 215, y: 705, o: 0.15 },
  { x: 228, y: 722, o: 0.17 },
  { x: 241, y: 739, o: 0.19 },
  { x: 254, y: 756, o: 0.03 },
  { x: 267, y: 773, o: 0.05 },
  { x: 280, y: 790, o: 0.07 },
  { x: 293, y: 807, o: 0.09 },
  { x: 306, y: 824, o: 0.11 },
  { x: 319, y: 841, o: 0.13 },
  { x: 332, y: 858, o: 0.15 },
  { x: 345, y: 875, o: 0.17 },
  { x: 358, y: 892, o: 0.19 },
  { x: 371, y: 909, o: 0.03 },
  { x: 384, y: 926, o: 0.05 },
  { x: 397, y: 943, o: 0.07 },
  { x: 410, y: 960, o: 0.09 },
  { x: 423, y: 457, o: 0.11 },
  { x: 436, y: 474, o: 0.13 },
  { x: 449, y: 491, o: 0.15 },
  { x: 462, y: 508, o: 0.17 },
  { x: 475, y: 525, o: 0.19 },
  { x: 488, y: 542, o: 0.03 },
  { x: 501, y: 559, o: 0.05 },
  { x: 514, y: 576, o: 0.07 },
  { x: 527, y: 593, o: 0.09 },
  { x: 540, y: 610, o: 0.11 },
  { x: 553, y: 627, o: 0.13 },
  { x: 566, y: 644, o: 0.15 },
  { x: 579, y: 661, o: 0.17 },
  { x: 592, y: 678, o: 0.19 },
  { x: 605, y: 695, o: 0.03 },
  { x: 618, y: 712, o: 0.05 },
  { x: 631, y: 729, o: 0.07 },
  { x: 644, y: 746, o: 0.09 },
  { x: 657, y: 763, o: 0.11 },
  { x: 670, y: 780, o: 0.13 },
  { x: 683, y: 797, o: 0.15 },
  { x: 696, y: 814, o: 0.17 },
  { x: 709, y: 831, o: 0.19 },
  { x: 722, y: 848, o: 0.03 },
  { x: 735, y: 865, o: 0.05 },
  { x: 748, y: 882, o: 0.07 },
  { x: 761, y: 899, o: 0.09 },
  { x: 774, y: 916, o: 0.11 },
  { x: 787, y: 933, o: 0.13 },
  { x: 800, y: 950, o: 0.15 },
  { x: 813, y: 967, o: 0.17 },
  { x: 826, y: 464, o: 0.19 },
  { x: 839, y: 481, o: 0.03 },
  { x: 852, y: 498, o: 0.05 },
  { x: 865, y: 515, o: 0.07 },
  { x: 878, y: 532, o: 0.09 },
  { x: 891, y: 549, o: 0.11 },
  { x: 904, y: 566, o: 0.13 },
  { x: 917, y: 583, o: 0.15 },
  { x: 930, y: 600, o: 0.17 },
  { x: 943, y: 617, o: 0.19 },
  { x: 956, y: 634, o: 0.03 },
  { x: 969, y: 651, o: 0.05 },
  { x: 982, y: 668, o: 0.07 },
  { x: 995, y: 685, o: 0.09 },
  { x: 1008, y: 702, o: 0.11 },
  { x: 1021, y: 719, o: 0.13 },
  { x: 1034, y: 736, o: 0.15 },
  { x: 1047, y: 753, o: 0.17 },
  { x: 1060, y: 770, o: 0.19 },
  { x: 1073, y: 787, o: 0.03 },
  { x: 1086, y: 804, o: 0.05 },
  { x: 1099, y: 821, o: 0.07 },
  { x: 1112, y: 838, o: 0.09 },
  { x: 1125, y: 855, o: 0.11 },
  { x: 1138, y: 872, o: 0.13 },
  { x: 1151, y: 889, o: 0.15 },
  { x: 1164, y: 906, o: 0.17 },
  { x: 1177, y: 923, o: 0.19 },
  { x: 1190, y: 940, o: 0.03 },
  { x: 1203, y: 957, o: 0.05 },
  { x: 1216, y: 454, o: 0.07 },
  { x: 1229, y: 471, o: 0.09 },
  { x: 1242, y: 488, o: 0.11 },
  { x: 1255, y: 505, o: 0.13 },
  { x: 1268, y: 522, o: 0.15 },
  { x: 1281, y: 539, o: 0.17 },
  { x: 1294, y: 556, o: 0.19 },
  { x: 1307, y: 573, o: 0.03 },
  { x: 1320, y: 590, o: 0.05 },
  { x: 1333, y: 607, o: 0.07 },
  { x: 1346, y: 624, o: 0.09 },
  { x: 1359, y: 641, o: 0.11 },
  { x: 1372, y: 658, o: 0.13 },
  { x: 1385, y: 675, o: 0.15 },
  { x: 1398, y: 692, o: 0.17 },
  { x: 1411, y: 709, o: 0.19 },
  { x: 1424, y: 726, o: 0.03 },
  { x: 1437, y: 743, o: 0.05 },
  { x: 1450, y: 760, o: 0.07 },
  { x: 1463, y: 777, o: 0.09 },
  { x: 1476, y: 794, o: 0.11 },
  { x: 1489, y: 811, o: 0.13 },
  { x: 1502, y: 828, o: 0.15 },
  { x: 1515, y: 845, o: 0.17 },
  { x: 1528, y: 862, o: 0.19 },
  { x: 1541, y: 879, o: 0.03 },
  { x: 1554, y: 896, o: 0.05 },
  { x: 1567, y: 913, o: 0.07 },
  { x: 1580, y: 930, o: 0.09 },
  { x: 1593, y: 947, o: 0.11 },
  { x: 1606, y: 964, o: 0.13 },
  { x: 1619, y: 461, o: 0.15 },
  { x: 1632, y: 478, o: 0.17 },
  { x: 1645, y: 495, o: 0.19 },
  { x: 1658, y: 512, o: 0.03 },
  { x: 1671, y: 529, o: 0.05 },
  { x: 1684, y: 546, o: 0.07 },
  { x: 1697, y: 563, o: 0.09 },
  { x: 1710, y: 580, o: 0.11 },
  { x: 1723, y: 597, o: 0.13 },
  { x: 1736, y: 614, o: 0.15 },
  { x: 1749, y: 631, o: 0.17 },
  { x: 1762, y: 648, o: 0.19 },
  { x: 1775, y: 665, o: 0.03 },
  { x: 1788, y: 682, o: 0.05 },
  { x: 1801, y: 699, o: 0.07 },
  { x: 1814, y: 716, o: 0.09 },
  { x: 1827, y: 733, o: 0.11 },
  { x: 1840, y: 750, o: 0.13 },
  { x: 1853, y: 767, o: 0.15 },
  { x: 1866, y: 784, o: 0.17 },
  { x: 1879, y: 801, o: 0.19 },
  { x: 1892, y: 818, o: 0.03 },
  { x: 25, y: 835, o: 0.05 },
  { x: 38, y: 852, o: 0.07 },
  { x: 51, y: 869, o: 0.09 },
  { x: 64, y: 886, o: 0.11 },
  { x: 77, y: 903, o: 0.13 },
  { x: 90, y: 920, o: 0.15 },
  { x: 103, y: 937, o: 0.17 },
  { x: 116, y: 954, o: 0.19 },
  { x: 129, y: 451, o: 0.03 },
  { x: 142, y: 468, o: 0.05 },
  { x: 155, y: 485, o: 0.07 },
  { x: 168, y: 502, o: 0.09 },
  { x: 181, y: 519, o: 0.11 },
  { x: 194, y: 536, o: 0.13 },
  { x: 207, y: 553, o: 0.15 },
  { x: 220, y: 570, o: 0.17 },
  { x: 233, y: 587, o: 0.19 },
  { x: 246, y: 604, o: 0.03 },
  { x: 259, y: 621, o: 0.05 },
  { x: 272, y: 638, o: 0.07 },
  { x: 285, y: 655, o: 0.09 },
  { x: 298, y: 672, o: 0.11 },
  { x: 311, y: 689, o: 0.13 },
  { x: 324, y: 706, o: 0.15 },
  { x: 337, y: 723, o: 0.17 },
  { x: 350, y: 740, o: 0.19 },
  { x: 363, y: 757, o: 0.03 },
  { x: 376, y: 774, o: 0.05 },
  { x: 389, y: 791, o: 0.07 },
  { x: 402, y: 808, o: 0.09 },
  { x: 415, y: 825, o: 0.11 },
  { x: 428, y: 842, o: 0.13 },
  { x: 441, y: 859, o: 0.15 },
  { x: 454, y: 876, o: 0.17 },
  { x: 467, y: 893, o: 0.19 },
  { x: 480, y: 910, o: 0.03 },
  { x: 493, y: 927, o: 0.05 },
  { x: 506, y: 944, o: 0.07 },
  { x: 519, y: 961, o: 0.09 },
  { x: 532, y: 458, o: 0.11 },
  { x: 545, y: 475, o: 0.13 },
  { x: 558, y: 492, o: 0.15 },
  { x: 571, y: 509, o: 0.17 },
  { x: 584, y: 526, o: 0.19 },
  { x: 597, y: 543, o: 0.03 },
  { x: 610, y: 560, o: 0.05 },
  { x: 623, y: 577, o: 0.07 },
  { x: 636, y: 594, o: 0.09 },
  { x: 649, y: 611, o: 0.11 },
  { x: 662, y: 628, o: 0.13 },
  { x: 675, y: 645, o: 0.15 },
  { x: 688, y: 662, o: 0.17 },
  { x: 701, y: 679, o: 0.19 },
  { x: 714, y: 696, o: 0.03 },
  { x: 727, y: 713, o: 0.05 },
  { x: 740, y: 730, o: 0.07 },
  { x: 753, y: 747, o: 0.09 },
  { x: 766, y: 764, o: 0.11 },
  { x: 779, y: 781, o: 0.13 },
  { x: 792, y: 798, o: 0.15 },
  { x: 805, y: 815, o: 0.17 },
  { x: 818, y: 832, o: 0.19 },
  { x: 831, y: 849, o: 0.03 },
  { x: 844, y: 866, o: 0.05 },
  { x: 857, y: 883, o: 0.07 },
  { x: 870, y: 900, o: 0.09 },
  { x: 883, y: 917, o: 0.11 },
  { x: 896, y: 934, o: 0.13 },
  { x: 909, y: 951, o: 0.15 },
  { x: 922, y: 968, o: 0.17 },
  { x: 935, y: 465, o: 0.19 },
  { x: 948, y: 482, o: 0.03 },
  { x: 961, y: 499, o: 0.05 },
  { x: 974, y: 516, o: 0.07 },
  { x: 987, y: 533, o: 0.09 },
  { x: 1000, y: 550, o: 0.11 },
  { x: 1013, y: 567, o: 0.13 },
  { x: 1026, y: 584, o: 0.15 },
  { x: 1039, y: 601, o: 0.17 },
  { x: 1052, y: 618, o: 0.19 },
  { x: 1065, y: 635, o: 0.03 },
  { x: 1078, y: 652, o: 0.05 },
  { x: 1091, y: 669, o: 0.07 },
  { x: 1104, y: 686, o: 0.09 },
  { x: 1117, y: 703, o: 0.11 },
  { x: 1130, y: 720, o: 0.13 },
  { x: 1143, y: 737, o: 0.15 },
  { x: 1156, y: 754, o: 0.17 },
  { x: 1169, y: 771, o: 0.19 },
  { x: 1182, y: 788, o: 0.03 },
  { x: 1195, y: 805, o: 0.05 },
  { x: 1208, y: 822, o: 0.07 },
  { x: 1221, y: 839, o: 0.09 },
  { x: 1234, y: 856, o: 0.11 },
  { x: 1247, y: 873, o: 0.13 },
  { x: 1260, y: 890, o: 0.15 },
  { x: 1273, y: 907, o: 0.17 },
  { x: 1286, y: 924, o: 0.19 },
  { x: 1299, y: 941, o: 0.03 },
  { x: 1312, y: 958, o: 0.05 },
  { x: 1325, y: 455, o: 0.07 },
  { x: 1338, y: 472, o: 0.09 },
  { x: 1351, y: 489, o: 0.11 },
  { x: 1364, y: 506, o: 0.13 },
  { x: 1377, y: 523, o: 0.15 },
  { x: 1390, y: 540, o: 0.17 },
  { x: 1403, y: 557, o: 0.19 },
  { x: 1416, y: 574, o: 0.03 },
  { x: 1429, y: 591, o: 0.05 },
  { x: 1442, y: 608, o: 0.07 },
  { x: 1455, y: 625, o: 0.09 },
  { x: 1468, y: 642, o: 0.11 },
  { x: 1481, y: 659, o: 0.13 },
  { x: 1494, y: 676, o: 0.15 },
  { x: 1507, y: 693, o: 0.17 },
  { x: 1520, y: 710, o: 0.19 },
  { x: 1533, y: 727, o: 0.03 },
  { x: 1546, y: 744, o: 0.05 },
  { x: 1559, y: 761, o: 0.07 },
  { x: 1572, y: 778, o: 0.09 },
  { x: 1585, y: 795, o: 0.11 },
  { x: 1598, y: 812, o: 0.13 },
  { x: 1611, y: 829, o: 0.15 },
  { x: 1624, y: 846, o: 0.17 },
  { x: 1637, y: 863, o: 0.19 },
  { x: 1650, y: 880, o: 0.03 },
  { x: 1663, y: 897, o: 0.05 },
  { x: 1676, y: 914, o: 0.07 },
  { x: 1689, y: 931, o: 0.09 },
  { x: 1702, y: 948, o: 0.11 },
  { x: 1715, y: 965, o: 0.13 },
  { x: 1728, y: 462, o: 0.15 },
  { x: 1741, y: 479, o: 0.17 },
  { x: 1754, y: 496, o: 0.19 },
  { x: 1767, y: 513, o: 0.03 },
  { x: 1780, y: 530, o: 0.05 },
  { x: 1793, y: 547, o: 0.07 },
  { x: 1806, y: 564, o: 0.09 },
  { x: 1819, y: 581, o: 0.11 },
  { x: 1832, y: 598, o: 0.13 },
  { x: 1845, y: 615, o: 0.15 },
  { x: 1858, y: 632, o: 0.17 },
  { x: 1871, y: 649, o: 0.19 },
  { x: 1884, y: 666, o: 0.03 },
  { x: 1897, y: 683, o: 0.05 },
  { x: 30, y: 700, o: 0.07 },
  { x: 43, y: 717, o: 0.09 },
  { x: 56, y: 734, o: 0.11 },
  { x: 69, y: 751, o: 0.13 },
  { x: 82, y: 768, o: 0.15 },
  { x: 95, y: 785, o: 0.17 },
  { x: 108, y: 802, o: 0.19 },
  { x: 121, y: 819, o: 0.03 },
  { x: 134, y: 836, o: 0.05 },
  { x: 147, y: 853, o: 0.07 },
  { x: 160, y: 870, o: 0.09 },
  { x: 173, y: 887, o: 0.11 },
  { x: 186, y: 904, o: 0.13 },
  { x: 199, y: 921, o: 0.15 },
  { x: 212, y: 938, o: 0.17 },
  { x: 225, y: 955, o: 0.19 },
  { x: 238, y: 452, o: 0.03 },
  { x: 251, y: 469, o: 0.05 },
  { x: 264, y: 486, o: 0.07 },
  { x: 277, y: 503, o: 0.09 },
  { x: 290, y: 520, o: 0.11 },
  { x: 303, y: 537, o: 0.13 },
  { x: 316, y: 554, o: 0.15 },
  { x: 329, y: 571, o: 0.17 },
  { x: 342, y: 588, o: 0.19 },
  { x: 355, y: 605, o: 0.03 },
  { x: 368, y: 622, o: 0.05 },
  { x: 381, y: 639, o: 0.07 },
  { x: 394, y: 656, o: 0.09 },
  { x: 407, y: 673, o: 0.11 },
  { x: 420, y: 690, o: 0.13 },
  { x: 433, y: 707, o: 0.15 },
  { x: 446, y: 724, o: 0.17 },
  { x: 459, y: 741, o: 0.19 },
  { x: 472, y: 758, o: 0.03 },
  { x: 485, y: 775, o: 0.05 },
  { x: 498, y: 792, o: 0.07 },
  { x: 511, y: 809, o: 0.09 },
  { x: 524, y: 826, o: 0.11 },
  { x: 537, y: 843, o: 0.13 },
  { x: 550, y: 860, o: 0.15 },
  { x: 563, y: 877, o: 0.17 },
  { x: 576, y: 894, o: 0.19 },
  { x: 589, y: 911, o: 0.03 },
  { x: 602, y: 928, o: 0.05 },
  { x: 615, y: 945, o: 0.07 },
  { x: 628, y: 962, o: 0.09 },
  { x: 641, y: 459, o: 0.11 },
  { x: 654, y: 476, o: 0.13 },
  { x: 667, y: 493, o: 0.15 },
  { x: 680, y: 510, o: 0.17 },
  { x: 693, y: 527, o: 0.19 },
  { x: 706, y: 544, o: 0.03 },
  { x: 719, y: 561, o: 0.05 },
  { x: 732, y: 578, o: 0.07 },
  { x: 745, y: 595, o: 0.09 },
  { x: 758, y: 612, o: 0.11 },
  { x: 771, y: 629, o: 0.13 },
  { x: 784, y: 646, o: 0.15 },
  { x: 797, y: 663, o: 0.17 },
  { x: 810, y: 680, o: 0.19 },
  { x: 823, y: 697, o: 0.03 },
  { x: 836, y: 714, o: 0.05 },
  { x: 849, y: 731, o: 0.07 },
  { x: 862, y: 748, o: 0.09 },
  { x: 875, y: 765, o: 0.11 },
  { x: 888, y: 782, o: 0.13 },
  { x: 901, y: 799, o: 0.15 },
  { x: 914, y: 816, o: 0.17 },
  { x: 927, y: 833, o: 0.19 },
  { x: 940, y: 850, o: 0.03 },
  { x: 953, y: 867, o: 0.05 },
  { x: 966, y: 884, o: 0.07 },
  { x: 979, y: 901, o: 0.09 },
  { x: 992, y: 918, o: 0.11 },
  { x: 1005, y: 935, o: 0.13 },
  { x: 1018, y: 952, o: 0.15 },
  { x: 1031, y: 969, o: 0.17 },
  { x: 1044, y: 466, o: 0.19 },
  { x: 1057, y: 483, o: 0.03 },
  { x: 1070, y: 500, o: 0.05 },
  { x: 1083, y: 517, o: 0.07 },
  { x: 1096, y: 534, o: 0.09 },
  { x: 1109, y: 551, o: 0.11 },
  { x: 1122, y: 568, o: 0.13 },
  { x: 1135, y: 585, o: 0.15 },
  { x: 1148, y: 602, o: 0.17 },
  { x: 1161, y: 619, o: 0.19 },
  { x: 1174, y: 636, o: 0.03 },
  { x: 1187, y: 653, o: 0.05 },
  { x: 1200, y: 670, o: 0.07 },
  { x: 1213, y: 687, o: 0.09 },
  { x: 1226, y: 704, o: 0.11 },
  { x: 1239, y: 721, o: 0.13 },
  { x: 1252, y: 738, o: 0.15 },
  { x: 1265, y: 755, o: 0.17 },
  { x: 1278, y: 772, o: 0.19 },
  { x: 1291, y: 789, o: 0.03 },
  { x: 1304, y: 806, o: 0.05 },
  { x: 1317, y: 823, o: 0.07 },
  { x: 1330, y: 840, o: 0.09 },
  { x: 1343, y: 857, o: 0.11 },
  { x: 1356, y: 874, o: 0.13 },
  { x: 1369, y: 891, o: 0.15 },
  { x: 1382, y: 908, o: 0.17 },
  { x: 1395, y: 925, o: 0.19 },
  { x: 1408, y: 942, o: 0.03 },
  { x: 1421, y: 959, o: 0.05 },
  { x: 1434, y: 456, o: 0.07 },
  { x: 1447, y: 473, o: 0.09 },
  { x: 1460, y: 490, o: 0.11 },
  { x: 1473, y: 507, o: 0.13 },
  { x: 1486, y: 524, o: 0.15 },
  { x: 1499, y: 541, o: 0.17 },
  { x: 1512, y: 558, o: 0.19 },
  { x: 1525, y: 575, o: 0.03 },
  { x: 1538, y: 592, o: 0.05 },
  { x: 1551, y: 609, o: 0.07 },
  { x: 1564, y: 626, o: 0.09 },
  { x: 1577, y: 643, o: 0.11 },
  { x: 1590, y: 660, o: 0.13 },
  { x: 1603, y: 677, o: 0.15 },
  { x: 1616, y: 694, o: 0.17 },
  { x: 1629, y: 711, o: 0.19 },
  { x: 1642, y: 728, o: 0.03 },
  { x: 1655, y: 745, o: 0.05 },
  { x: 1668, y: 762, o: 0.07 },
  { x: 1681, y: 779, o: 0.09 },
  { x: 1694, y: 796, o: 0.11 },
  { x: 1707, y: 813, o: 0.13 },
  { x: 1720, y: 830, o: 0.15 },
  { x: 1733, y: 847, o: 0.17 },
  { x: 1746, y: 864, o: 0.19 },
  { x: 1759, y: 881, o: 0.03 },
  { x: 1772, y: 898, o: 0.05 },
  { x: 1785, y: 915, o: 0.07 },
  { x: 1798, y: 932, o: 0.09 },
  { x: 1811, y: 949, o: 0.11 },
  { x: 1824, y: 966, o: 0.13 },
  { x: 1837, y: 463, o: 0.15 },
  { x: 1850, y: 480, o: 0.17 },
  { x: 1863, y: 497, o: 0.19 },
  { x: 1876, y: 514, o: 0.03 },
  { x: 1889, y: 531, o: 0.05 },
  { x: 22, y: 548, o: 0.07 },
  { x: 35, y: 565, o: 0.09 },
  { x: 48, y: 582, o: 0.11 },
  { x: 61, y: 599, o: 0.13 },
  { x: 74, y: 616, o: 0.15 },
  { x: 87, y: 633, o: 0.17 },
  { x: 100, y: 650, o: 0.19 },
  { x: 113, y: 667, o: 0.03 },
  { x: 126, y: 684, o: 0.05 },
  { x: 139, y: 701, o: 0.07 },
  { x: 152, y: 718, o: 0.09 },
  { x: 165, y: 735, o: 0.11 },
  { x: 178, y: 752, o: 0.13 },
  { x: 191, y: 769, o: 0.15 },
  { x: 204, y: 786, o: 0.17 },
  { x: 217, y: 803, o: 0.19 },
  { x: 230, y: 820, o: 0.03 },
  { x: 243, y: 837, o: 0.05 },
  { x: 256, y: 854, o: 0.07 },
  { x: 269, y: 871, o: 0.09 },
  { x: 282, y: 888, o: 0.11 },
  { x: 295, y: 905, o: 0.13 },
  { x: 308, y: 922, o: 0.15 },
  { x: 321, y: 939, o: 0.17 },
  { x: 334, y: 956, o: 0.19 },
  { x: 347, y: 453, o: 0.03 },
  { x: 360, y: 470, o: 0.05 },
  { x: 373, y: 487, o: 0.07 },
  { x: 386, y: 504, o: 0.09 },
  { x: 399, y: 521, o: 0.11 },
  { x: 412, y: 538, o: 0.13 },
  { x: 425, y: 555, o: 0.15 },
  { x: 438, y: 572, o: 0.17 },
  { x: 451, y: 589, o: 0.19 },
  { x: 464, y: 606, o: 0.03 },
  { x: 477, y: 623, o: 0.05 },
  { x: 490, y: 640, o: 0.07 },
  { x: 503, y: 657, o: 0.09 },
  { x: 516, y: 674, o: 0.11 },
  { x: 529, y: 691, o: 0.13 },
  { x: 542, y: 708, o: 0.15 },
  { x: 555, y: 725, o: 0.17 },
  { x: 568, y: 742, o: 0.19 },
  { x: 581, y: 759, o: 0.03 },
  { x: 594, y: 776, o: 0.05 },
  { x: 607, y: 793, o: 0.07 },
  { x: 620, y: 810, o: 0.09 },
  { x: 633, y: 827, o: 0.11 },
  { x: 646, y: 844, o: 0.13 },
  { x: 659, y: 861, o: 0.15 },
  { x: 672, y: 878, o: 0.17 },
  { x: 685, y: 895, o: 0.19 },
  { x: 698, y: 912, o: 0.03 },
  { x: 711, y: 929, o: 0.05 },
  { x: 724, y: 946, o: 0.07 },
  { x: 737, y: 963, o: 0.09 },
  { x: 750, y: 460, o: 0.11 },
  { x: 763, y: 477, o: 0.13 },
  { x: 776, y: 494, o: 0.15 },
  { x: 789, y: 511, o: 0.17 },
  { x: 802, y: 528, o: 0.19 },
  { x: 815, y: 545, o: 0.03 },
  { x: 828, y: 562, o: 0.05 },
  { x: 841, y: 579, o: 0.07 },
  { x: 854, y: 596, o: 0.09 },
  { x: 867, y: 613, o: 0.11 },
  { x: 880, y: 630, o: 0.13 },
  { x: 893, y: 647, o: 0.15 },
  { x: 906, y: 664, o: 0.17 },
  { x: 919, y: 681, o: 0.19 },
  { x: 932, y: 698, o: 0.03 },
  { x: 945, y: 715, o: 0.05 },
  { x: 958, y: 732, o: 0.07 },
  { x: 971, y: 749, o: 0.09 },
  { x: 984, y: 766, o: 0.11 },
  { x: 997, y: 783, o: 0.13 },
  { x: 1010, y: 800, o: 0.15 },
  { x: 1023, y: 817, o: 0.17 },
  { x: 1036, y: 834, o: 0.19 },
  { x: 1049, y: 851, o: 0.03 },
  { x: 1062, y: 868, o: 0.05 },
  { x: 1075, y: 885, o: 0.07 },
  { x: 1088, y: 902, o: 0.09 },
  { x: 1101, y: 919, o: 0.11 },
  { x: 1114, y: 936, o: 0.13 },
  { x: 1127, y: 953, o: 0.15 },
] as const;

const HAZE_STRIPES = [
  { y: 520, o: 0.01 },
  { y: 521, o: 0.02 },
  { y: 522, o: 0.03 },
  { y: 523, o: 0.04 },
  { y: 524, o: 0.05 },
  { y: 525, o: 0.06 },
  { y: 526, o: 0.07 },
  { y: 527, o: 0.08 },
  { y: 528, o: 0.01 },
  { y: 529, o: 0.02 },
  { y: 530, o: 0.03 },
  { y: 531, o: 0.04 },
  { y: 532, o: 0.05 },
  { y: 533, o: 0.06 },
  { y: 534, o: 0.07 },
  { y: 535, o: 0.08 },
  { y: 536, o: 0.01 },
  { y: 537, o: 0.02 },
  { y: 538, o: 0.03 },
  { y: 539, o: 0.04 },
  { y: 540, o: 0.05 },
  { y: 541, o: 0.06 },
  { y: 542, o: 0.07 },
  { y: 543, o: 0.08 },
  { y: 544, o: 0.01 },
  { y: 545, o: 0.02 },
  { y: 546, o: 0.03 },
  { y: 547, o: 0.04 },
  { y: 548, o: 0.05 },
  { y: 549, o: 0.06 },
  { y: 550, o: 0.07 },
  { y: 551, o: 0.08 },
  { y: 552, o: 0.01 },
  { y: 553, o: 0.02 },
  { y: 554, o: 0.03 },
  { y: 555, o: 0.04 },
  { y: 556, o: 0.05 },
  { y: 557, o: 0.06 },
  { y: 558, o: 0.07 },
  { y: 559, o: 0.08 },
  { y: 560, o: 0.01 },
  { y: 561, o: 0.02 },
  { y: 562, o: 0.03 },
  { y: 563, o: 0.04 },
  { y: 564, o: 0.05 },
  { y: 565, o: 0.06 },
  { y: 566, o: 0.07 },
  { y: 567, o: 0.08 },
  { y: 568, o: 0.01 },
  { y: 569, o: 0.02 },
  { y: 570, o: 0.03 },
  { y: 571, o: 0.04 },
  { y: 572, o: 0.05 },
  { y: 573, o: 0.06 },
  { y: 574, o: 0.07 },
  { y: 575, o: 0.08 },
  { y: 576, o: 0.01 },
  { y: 577, o: 0.02 },
  { y: 578, o: 0.03 },
  { y: 579, o: 0.04 },
  { y: 580, o: 0.05 },
  { y: 581, o: 0.06 },
  { y: 582, o: 0.07 },
  { y: 583, o: 0.08 },
  { y: 584, o: 0.01 },
  { y: 585, o: 0.02 },
  { y: 586, o: 0.03 },
  { y: 587, o: 0.04 },
  { y: 588, o: 0.05 },
  { y: 589, o: 0.06 },
  { y: 590, o: 0.07 },
  { y: 591, o: 0.08 },
  { y: 592, o: 0.01 },
  { y: 593, o: 0.02 },
  { y: 594, o: 0.03 },
  { y: 595, o: 0.04 },
  { y: 596, o: 0.05 },
  { y: 597, o: 0.06 },
  { y: 598, o: 0.07 },
  { y: 599, o: 0.08 },
  { y: 600, o: 0.01 },
  { y: 601, o: 0.02 },
  { y: 602, o: 0.03 },
  { y: 603, o: 0.04 },
  { y: 604, o: 0.05 },
  { y: 605, o: 0.06 },
  { y: 606, o: 0.07 },
  { y: 607, o: 0.08 },
  { y: 608, o: 0.01 },
  { y: 609, o: 0.02 },
  { y: 610, o: 0.03 },
  { y: 611, o: 0.04 },
  { y: 612, o: 0.05 },
  { y: 613, o: 0.06 },
  { y: 614, o: 0.07 },
  { y: 615, o: 0.08 },
  { y: 616, o: 0.01 },
  { y: 617, o: 0.02 },
  { y: 618, o: 0.03 },
  { y: 619, o: 0.04 },
  { y: 620, o: 0.05 },
  { y: 621, o: 0.06 },
  { y: 622, o: 0.07 },
  { y: 623, o: 0.08 },
  { y: 624, o: 0.01 },
  { y: 625, o: 0.02 },
  { y: 626, o: 0.03 },
  { y: 627, o: 0.04 },
  { y: 628, o: 0.05 },
  { y: 629, o: 0.06 },
  { y: 630, o: 0.07 },
  { y: 631, o: 0.08 },
  { y: 632, o: 0.01 },
  { y: 633, o: 0.02 },
  { y: 634, o: 0.03 },
  { y: 635, o: 0.04 },
  { y: 636, o: 0.05 },
  { y: 637, o: 0.06 },
  { y: 638, o: 0.07 },
  { y: 639, o: 0.08 },
  { y: 640, o: 0.01 },
  { y: 641, o: 0.02 },
  { y: 642, o: 0.03 },
  { y: 643, o: 0.04 },
  { y: 644, o: 0.05 },
  { y: 645, o: 0.06 },
  { y: 646, o: 0.07 },
  { y: 647, o: 0.08 },
  { y: 648, o: 0.01 },
  { y: 649, o: 0.02 },
  { y: 650, o: 0.03 },
  { y: 651, o: 0.04 },
  { y: 652, o: 0.05 },
  { y: 653, o: 0.06 },
  { y: 654, o: 0.07 },
  { y: 655, o: 0.08 },
  { y: 656, o: 0.01 },
  { y: 657, o: 0.02 },
  { y: 658, o: 0.03 },
  { y: 659, o: 0.04 },
  { y: 660, o: 0.05 },
  { y: 661, o: 0.06 },
  { y: 662, o: 0.07 },
  { y: 663, o: 0.08 },
  { y: 664, o: 0.01 },
  { y: 665, o: 0.02 },
  { y: 666, o: 0.03 },
  { y: 667, o: 0.04 },
  { y: 668, o: 0.05 },
  { y: 669, o: 0.06 },
  { y: 670, o: 0.07 },
  { y: 671, o: 0.08 },
  { y: 672, o: 0.01 },
  { y: 673, o: 0.02 },
  { y: 674, o: 0.03 },
  { y: 675, o: 0.04 },
  { y: 676, o: 0.05 },
  { y: 677, o: 0.06 },
  { y: 678, o: 0.07 },
  { y: 679, o: 0.08 },
  { y: 680, o: 0.01 },
  { y: 681, o: 0.02 },
  { y: 682, o: 0.03 },
  { y: 683, o: 0.04 },
  { y: 684, o: 0.05 },
  { y: 685, o: 0.06 },
  { y: 686, o: 0.07 },
  { y: 687, o: 0.08 },
  { y: 688, o: 0.01 },
  { y: 689, o: 0.02 },
  { y: 690, o: 0.03 },
  { y: 691, o: 0.04 },
  { y: 692, o: 0.05 },
  { y: 693, o: 0.06 },
  { y: 694, o: 0.07 },
  { y: 695, o: 0.08 },
  { y: 696, o: 0.01 },
  { y: 697, o: 0.02 },
  { y: 698, o: 0.03 },
  { y: 699, o: 0.04 },
  { y: 700, o: 0.05 },
  { y: 701, o: 0.06 },
  { y: 702, o: 0.07 },
  { y: 703, o: 0.08 },
  { y: 704, o: 0.01 },
  { y: 705, o: 0.02 },
  { y: 706, o: 0.03 },
  { y: 707, o: 0.04 },
  { y: 708, o: 0.05 },
  { y: 709, o: 0.06 },
  { y: 710, o: 0.07 },
  { y: 711, o: 0.08 },
  { y: 712, o: 0.01 },
  { y: 713, o: 0.02 },
  { y: 714, o: 0.03 },
  { y: 715, o: 0.04 },
  { y: 716, o: 0.05 },
  { y: 717, o: 0.06 },
  { y: 718, o: 0.07 },
  { y: 719, o: 0.08 },
  { y: 720, o: 0.01 },
  { y: 721, o: 0.02 },
  { y: 722, o: 0.03 },
  { y: 723, o: 0.04 },
  { y: 724, o: 0.05 },
  { y: 725, o: 0.06 },
  { y: 726, o: 0.07 },
  { y: 727, o: 0.08 },
  { y: 728, o: 0.01 },
  { y: 729, o: 0.02 },
  { y: 730, o: 0.03 },
  { y: 731, o: 0.04 },
  { y: 732, o: 0.05 },
  { y: 733, o: 0.06 },
  { y: 734, o: 0.07 },
  { y: 735, o: 0.08 },
  { y: 736, o: 0.01 },
  { y: 737, o: 0.02 },
  { y: 738, o: 0.03 },
  { y: 739, o: 0.04 },
  { y: 740, o: 0.05 },
  { y: 741, o: 0.06 },
  { y: 742, o: 0.07 },
  { y: 743, o: 0.08 },
  { y: 744, o: 0.01 },
  { y: 745, o: 0.02 },
  { y: 746, o: 0.03 },
  { y: 747, o: 0.04 },
  { y: 748, o: 0.05 },
  { y: 749, o: 0.06 },
  { y: 750, o: 0.07 },
  { y: 751, o: 0.08 },
  { y: 752, o: 0.01 },
  { y: 753, o: 0.02 },
  { y: 754, o: 0.03 },
  { y: 755, o: 0.04 },
  { y: 756, o: 0.05 },
  { y: 757, o: 0.06 },
  { y: 758, o: 0.07 },
  { y: 759, o: 0.08 },
  { y: 760, o: 0.01 },
  { y: 761, o: 0.02 },
  { y: 762, o: 0.03 },
  { y: 763, o: 0.04 },
  { y: 764, o: 0.05 },
  { y: 765, o: 0.06 },
  { y: 766, o: 0.07 },
  { y: 767, o: 0.08 },
  { y: 768, o: 0.01 },
  { y: 769, o: 0.02 },
  { y: 770, o: 0.03 },
  { y: 771, o: 0.04 },
  { y: 772, o: 0.05 },
  { y: 773, o: 0.06 },
  { y: 774, o: 0.07 },
  { y: 775, o: 0.08 },
  { y: 776, o: 0.01 },
  { y: 777, o: 0.02 },
  { y: 778, o: 0.03 },
  { y: 779, o: 0.04 },
  { y: 780, o: 0.05 },
  { y: 781, o: 0.06 },
  { y: 782, o: 0.07 },
  { y: 783, o: 0.08 },
  { y: 784, o: 0.01 },
  { y: 785, o: 0.02 },
  { y: 786, o: 0.03 },
  { y: 787, o: 0.04 },
  { y: 788, o: 0.05 },
  { y: 789, o: 0.06 },
  { y: 790, o: 0.07 },
  { y: 791, o: 0.08 },
  { y: 792, o: 0.01 },
  { y: 793, o: 0.02 },
  { y: 794, o: 0.03 },
  { y: 795, o: 0.04 },
  { y: 796, o: 0.05 },
  { y: 797, o: 0.06 },
  { y: 798, o: 0.07 },
  { y: 799, o: 0.08 },
  { y: 800, o: 0.01 },
  { y: 801, o: 0.02 },
  { y: 802, o: 0.03 },
  { y: 803, o: 0.04 },
  { y: 804, o: 0.05 },
  { y: 805, o: 0.06 },
  { y: 806, o: 0.07 },
  { y: 807, o: 0.08 },
  { y: 808, o: 0.01 },
  { y: 809, o: 0.02 },
  { y: 810, o: 0.03 },
  { y: 811, o: 0.04 },
  { y: 812, o: 0.05 },
  { y: 813, o: 0.06 },
  { y: 814, o: 0.07 },
  { y: 815, o: 0.08 },
  { y: 816, o: 0.01 },
  { y: 817, o: 0.02 },
  { y: 818, o: 0.03 },
  { y: 819, o: 0.04 },
] as const;

const generateGrass = (): GrassData[] => {
  const rand = seededRandom(5005);
  const hues = ['#9fbe5d', '#8db35b', '#a8c66a', '#86a94f', '#b8ca76'];
  return new Array(1800).fill(null).map((_, id) => ({
    id,
    x: rand() * 1920,
    y: 530 + rand() * 520,
    h: 18 + rand() * 110,
    width: 0.8 + rand() * 2.8,
    hue: hues[Math.floor(rand() * hues.length)],
    delay: rand() * Math.PI * 2,
    offset: rand() * 2 - 1,
    layer: id < 600 ? 0 : id < 1300 ? 1 : 2,
  }));
};

const generateOaks = (): OakSeed[] => {
  const rand = seededRandom(9090);
  const tones = ['#5f8a41', '#6d9650', '#7aa65b', '#4f7c39'];
  return new Array(18).fill(null).map((_, id) => ({
    id,
    x: 120 + id * 98 + rand() * 70,
    y: 520 + rand() * 180,
    scale: 0.6 + rand() * 0.95,
    jitter: 0.6 + rand() * 1.7,
    tone: tones[Math.floor(rand() * tones.length)],
  }));
};

const generateVillagers = (): Villager[] => {
  const rand = seededRandom(3311);
  return new Array(34).fill(null).map((_, id) => ({
    id,
    x: 260 + rand() * 1420,
    y: 620 + rand() * 180,
    scale: 0.35 + rand() * 0.45,
    action: Math.floor(rand() * 4),
  }));
};

const GrassBlade: React.FC<{ blade: GrassData; frame: number; near?: boolean }> = ({ blade, frame, near = false }) => {
  const wind = Math.sin(frame / 20 + blade.x * 0.01 + blade.delay) * (8 + blade.layer * 7) + Math.sin(frame / 33 + blade.delay) * 4;
  const bend = wind * (0.18 + blade.offset * 0.12);
  const tipX = blade.x + bend;
  const tipY = blade.y - blade.h;
  const ctrlX = blade.x + bend * 0.55;
  const ctrlY = blade.y - blade.h * 0.45;
  return (
    <path
      d={`M ${blade.x} ${blade.y} Q ${ctrlX} ${ctrlY} ${tipX} ${tipY}`}
      fill="none"
      stroke={blade.hue}
      strokeWidth={near ? blade.width * 1.45 : blade.width}
      opacity={near ? 0.88 : 0.66 + blade.layer * 0.12}
      strokeLinecap="round"
    />
  );
};

const SavannaField: React.FC = () => {
  const frame = useCurrentFrame();
  const blades = useMemo(generateGrass, []);
  const far = blades.filter((b) => b.layer === 0);
  const mid = blades.filter((b) => b.layer === 1);
  const near = blades.filter((b) => b.layer === 2);
  return (
    <g>
      {far.map((blade) => (<GrassBlade key={`f-${blade.id}`} blade={blade} frame={frame} />))}
      {mid.map((blade) => (<GrassBlade key={`m-${blade.id}`} blade={blade} frame={frame} />))}
      {near.map((blade) => (<GrassBlade key={`n-${blade.id}`} blade={blade} frame={frame} near />))}
    </g>
  );
};

const branchSplit = (x: number, y: number, length: number, angle: number, depth: number, jitter: number): Array<{ x1: number; y1: number; x2: number; y2: number; w: number }> => {
  if (depth <= 0 || length < 3) return [];
  const x2 = x + Math.cos(angle) * length;
  const y2 = y - Math.sin(angle) * length;
  const w = Math.max(0.8, depth * 1.2);
  const left = branchSplit(x2, y2, length * 0.76, angle + 0.42 + Math.sin(x * 0.01) * jitter * 0.02, depth - 1, jitter);
  const right = branchSplit(x2, y2, length * 0.74, angle - 0.4 + Math.cos(y * 0.01) * jitter * 0.02, depth - 1, jitter);
  const middle = branchSplit(x2, y2, length * 0.58, angle + 0.04, depth - 1, jitter);
  return [{ x1: x, y1: y, x2, y2, w }, ...left, ...right, ...middle];
};

const ProceduralOak: React.FC<{ seed: OakSeed }> = ({ seed }) => {
  const branches = useMemo(() => branchSplit(seed.x, seed.y, 46 * seed.scale, Math.PI / 2, 6, seed.jitter), [seed]);
  const leaves = useMemo(() => {
    const rand = seededRandom(seed.id * 79 + 19);
    return new Array(160).fill(null).map((_, i) => ({
      id: i,
      x: seed.x + (rand() - 0.5) * 180 * seed.scale,
      y: seed.y - 80 * seed.scale + (rand() - 0.5) * 110 * seed.scale,
      r: 4 + rand() * 11 * seed.scale,
      o: 0.3 + rand() * 0.45,
    }));
  }, [seed]);
  return (
    <g>
      {branches.map((b, idx) => (<line key={idx} x1={b.x1} y1={b.y1} x2={b.x2} y2={b.y2} stroke="#5b3d24" strokeWidth={b.w} strokeLinecap="round" />))}
      {leaves.map((l) => (<circle key={l.id} cx={l.x} cy={l.y} r={l.r} fill={seed.tone} opacity={l.o} />))}
    </g>
  );
};

const VillagerDots: React.FC = () => {
  const frame = useCurrentFrame();
  const villagers = useMemo(generateVillagers, []);
  return (
    <g>
      {villagers.map((v) => {
        const bob = Math.sin(frame / 12 + v.id) * 3;
        return (
          <g key={v.id} transform={`translate(${v.x}, ${v.y + bob}) scale(${v.scale})`}>
            <circle cx={0} cy={-12} r={5} fill="#805f3d" />
            <rect x={-4} y={-8} width={8} height={18} rx={3} fill="#6a4e31" />
            {v.action === 0 && <line x1={-4} y1={0} x2={-12} y2={10} stroke="#5d452d" strokeWidth={2} />}
            {v.action === 1 && <line x1={4} y1={0} x2={12} y2={10} stroke="#5d452d" strokeWidth={2} />}
            {v.action === 2 && <line x1={-2} y1={10} x2={-10} y2={18} stroke="#5d452d" strokeWidth={2} />}
            {v.action === 3 && <line x1={2} y1={10} x2={10} y2={18} stroke="#5d452d" strokeWidth={2} />}
          </g>
        );
      })}
    </g>
  );
};

const DriftingClouds: React.FC = () => {
  const frame = useCurrentFrame();
  const clouds = useMemo(() => {
    const rand = seededRandom(6601);
    return new Array(18).fill(null).map((_, id) => ({
      id,
      x: rand() * 1920,
      y: 70 + rand() * 220,
      scale: 0.8 + rand() * 1.6,
      speed: 0.2 + rand() * 0.8,
      phase: rand() * Math.PI * 2,
    }));
  }, []);
  return (
    <g>
      {clouds.map((c) => {
        const x = (c.x + frame * c.speed + Math.sin(frame / 50 + c.phase) * 20) % 2100 - 90;
        return (
          <g key={c.id} transform={`translate(${x}, ${c.y}) scale(${c.scale})`} opacity={0.65}>
            <circle cx={0} cy={0} r={38} fill="#ffffff" />
            <circle cx={42} cy={-8} r={34} fill="#ffffff" />
            <circle cx={78} cy={6} r={30} fill="#ffffff" />
            <ellipse cx={42} cy={20} rx={84} ry={26} fill="#ffffff" />
          </g>
        );
      })}
    </g>
  );
};

const SunFlare: React.FC = () => {
  const frame = useCurrentFrame();
  const pulse = interpolate(Math.sin(frame / 28), [-1, 1], [0.82, 1.18]);
  return (
    <g>
      <circle cx={280} cy={160} r={110} fill="#ffd56e" opacity={0.38 * pulse} />
      <circle cx={280} cy={160} r={180} fill="#ffd56e" opacity={0.15 * pulse} />
      <circle cx={280} cy={160} r={260} fill="#ffd56e" opacity={0.06 * pulse} />
      {[0,1,2,3,4,5].map((i) => (<ellipse key={i} cx={420 + i * 210} cy={190 + i * 60} rx={30 + i * 6} ry={12 + i * 3} fill="#ffdca0" opacity={0.06 + i * 0.03} />))}
    </g>
  );
};

const HeatHaze: React.FC = () => {
  return (
    <g filter="url(#heat-haze)">
      <rect x={0} y={460} width={1920} height={220} fill="rgba(255,220,160,0.08)" />
      {HAZE_STRIPES.map((s, idx) => (<rect key={idx} x={0} y={s.y} width={1920} height={1} fill="#fff5db" opacity={s.o} />))}
    </g>
  );
};

const MountainsFar: React.FC = () => {
  return (
    <g opacity={0.52}>
      <polygon points="0,620 280,460 540,620" fill="#8398b0" />
      <polygon points="300,620 660,430 980,620" fill="#7d91a8" />
      <polygon points="760,620 1140,450 1470,620" fill="#899db3" />
      <polygon points="1260,620 1590,440 1920,620" fill="#7c90a6" />
    </g>
  );
};

export const Scene05: React.FC = () => {
  const frame = useCurrentFrame();
  const { fps } = useVideoConfig();
  const prehistoric = Palette.Prehistoric;
  const oakSeeds = useMemo(generateOaks, []);
  const camera = 1 + spring({ frame, fps, config: { damping: 200, stiffness: 38 } }) * 0.01;
  const horizonWave = Math.sin(frame / 60) * 6;
  return (
    <SceneShell title="Scene 05 Â· Savanna Breeze" act="Prehistoric">
      <AbsoluteFill style={{ transform: `scale(${camera})`, transformOrigin: '50% 50%' }}>
        <svg viewBox="0 0 1920 1080" width="100%" height="100%">
          <defs>
            <linearGradient id="sky-grad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#8fd0ff" /><stop offset="60%" stopColor="#bfe5ff" /><stop offset="100%" stopColor="#f2d98f" /></linearGradient>
            <linearGradient id="ground-grad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#b9c76b" /><stop offset="100%" stopColor="#7f9941" /></linearGradient>
            <filter id="heat-haze" x="-20%" y="-20%" width="140%" height="140%"><feTurbulence type="fractalNoise" baseFrequency="0.008 0.06" numOctaves="2" seed="7" result="noise" /><feDisplacementMap in="SourceGraphic" in2="noise" scale="8" xChannelSelector="R" yChannelSelector="G" /></filter>
          </defs>
          <rect x={0} y={0} width={1920} height={1080} fill={prehistoric.background} />
          <rect x={0} y={0} width={1920} height={700} fill="url(#sky-grad)" />
          <DriftingClouds />
          <SunFlare />
          <MountainsFar />
          <path d={`M 0 ${620 + horizonWave} Q 480 ${560 + horizonWave} 960 ${620 + horizonWave} Q 1440 ${680 + horizonWave} 1920 ${620 + horizonWave} L 1920 1080 L 0 1080 Z`} fill="url(#ground-grad)" />
          <HeatHaze />
          {oakSeeds.map((seed) => (<ProceduralOak key={seed.id} seed={seed} />))}
          <VillagerDots />
          <SavannaField />
          {WIND_MARKERS.map((m, idx) => (<circle key={idx} cx={m.x + Math.sin(frame / 18 + idx) * 10} cy={m.y + Math.cos(frame / 28 + idx) * 4} r={1.2 + (idx % 3) * 0.6} fill="#fff0cc" opacity={m.o} />))}
          <g transform="translate(880, 560)"><ProfessorPint talking={false} scale={1.22} /></g>
        </svg>
      </AbsoluteFill>
    </SceneShell>
  );
};
